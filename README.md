# Using JMeters to pumping notification bus for Ceilometer/Gnocchi

## Basic Steps
* extract the jmeter.zip
```sh
$ unzip jmeter.zip
```
* use scripts/generate_data.py to generate data into a csv file
```sh
$ scripts/generate_data.py --file data.polling.csv --type polling --name test.meter --batch-count 1 --start 1 --end 0 --interval 3600 --volume 1.2 --random_min 0.1 --random_max 1.0
```
* run jmeter against the test plan defined in ceilometer.jmx
```sh
$ apache-jmeter-2.13/bin/jmeter -JDATA_FILE=/root/data.polling.csv -n -t ceilometer.jmx
```

## Generate data into a csv file
Users should use scripts/generate_data.py to generate the data to be pumped into the notification bus into a csv file in advance. To run this python script, you must have the  openstack python module "ceilometer" installed on the host first.(This scripts will NOT run any ceilometer component, but to use some internal ceilometer modules)

Users should specify which type of data to be generated by using --type command line parameter: 
* polling: if you want to generate data as in the same format as the data generated by ceilometer polling agent, which is to be consumed by the ceilometer notification agent
* notification(waiting for Yarko's code here): if you want to generate data as in the same format as the data generated by other OpenStack service notifications, which is to be consumed by the ceilometer notification agent
* pipeline: if you want to generate data as in the same format as the data generated by ceilometer notification agent, which is to be consumed by the ceilometer collector

Please run the following command to see the details of all the command line parameter
```sh
$ scripts/generate_data.sh --help
```

## Test plan parameters
The following test plan parameters can be specified on the command line by using the following syntax:
```sh
$ apache-jmeter-2.13/bin/jmeter -J<param_name1>=<param_value1> J<param_name2>=<param_value2> -n -t ceilometer.jmx
```
* THREADS: number of threads, default is 3
* LOOP: number of times to execute the test, default is 1
* RAMPUP: time in seconds for the ramp-up periods, default is 1 sec

NOTE: Please see [JMeter doc for the details of the above 3 paramters](http://jmeter.apache.org/usermanual/test_plan.html#thread_group)
* RABBITMQ_HOST: rabbitmq host address, default is 127.0.0.1
* RABBITMQ_USER: rabbitmq user name, default is stackrabbit
* RABBITMQ_PASS: rabbitmq password, default is 123456
* DATA_FILE: csv data file, default is data.csv
